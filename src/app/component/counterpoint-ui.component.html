<div class="cp-wrapper" [class.dark]="_dark">
  <mat-card class="cp-card" [ngSwitch]="_activeTab">
    <p class="subtitle" style="margin-top:6px">
      This tool applies Sergei Taneyev‚Äôs vertical shifting (invertible) counterpoint. Enter JV indices to see
      how intervals behave after inversion in 2- and 3-voice textures.
    </p>

    <details class="info" style="margin-bottom:12px;">
      <summary class="info-summary" aria-label="Open information panel">
        ‚ÑπÔ∏è What it does ‚Ä¢ Use ‚Ä¢ Notes
      </summary>
      <div class="info-body">
        <p><strong>What:</strong> Shows interval classes as Fixed/Variable Consonance or Dissonance before/after
          inversion.
          In 3-voice mode, enter <code>JV‚Ä≤</code> (I‚ÜîII) and <code>JV‚Ä≥</code> (II‚ÜîIII); the app derives <code>JVŒ£</code>
          (I‚ÜîIII).</p>

        <p><strong>Use:</strong>
          1) 2-voice: set <code>JV</code> and read the grid (amber dot = imperfect ‚Üí perfect).
          2) 3-voice: set <code>JV‚Ä≤</code>, <code>JV‚Ä≥</code> to compare I‚ÜîII, II‚ÜîIII, I‚ÜîIII.</p>

        <p><strong>Why:</strong> Plan themes/textures that survive voice swaps; spot safe (fixed) vs context-dependent
          (variable) intervals.</p>

        <p><strong>Notes:</strong> Focuses on vertical behaviour; it doesn‚Äôt auto-enforce rhythmic species rules. Treat
          as a compositional aid.</p>

        <p style="margin-top:8px; font-size:.9rem; opacity:.9;">Author: Anemone Lux ‚Ä¢ Feedback welcome.</p>
      </div>
    </details>

    <div class="card-top">
      <h1 class="title">
        {{
          _activeTab === 'two'
            ? "Two-Voice Vertical Shifting Counterpoint"
            : "Three-Voice Vertical Shifting Counterpoint"
        }}
      </h1>
      <button
        type="button"
        class="theme-toggle"
        (click)="toggleDark()"
        [attr.aria-pressed]="_dark"
        [matTooltip]="_dark ? 'Switch to light mode' : 'Switch to dark mode'">
        <span aria-hidden="true">{{ _dark ? '‚òÄÔ∏è' : 'üåô' }}</span>
        <span class="sr-only">{{ _dark ? 'Light mode' : 'Dark mode' }}</span>
      </button>
      <div class="view-toggle" role="tablist" aria-label="View">
        <button
          class="toggle"
          role="tab"
          [attr.aria-selected]="_activeTab === 'two'"
          [class.active]="_activeTab === 'two'"
          (click)="_activeTab = 'two'">
          2-voice
        </button>
        <button
          class="toggle"
          role="tab"
          [attr.aria-selected]="_activeTab === 'three'"
          [class.active]="_activeTab === 'three'"
          (click)="_activeTab = 'three'">
          3-voice
        </button>
      </div>
    </div>

    <ng-container *ngSwitchCase="'two'">
      <div class="card-header"></div>

      <p class="subtitle">
        Enter a JV (inversion index) to see which intervals stay or switch between consonance and dissonance after
        inversion.
      </p>
      <div class="controls">
        <div class="control">
          <label for="jv">JV</label>
          <input
            id="jv"
            type="number"
            [(ngModel)]="_jvInput"
          />
        </div>
      </div>

      <app-interval-row
        [_intervalsList]="_indices"
        [_cells]="_cells"
        [_intervals]="_intervals"
        [_jvInput]="_jvInput">
      </app-interval-row>

    </ng-container>

    <ng-container *ngSwitchCase="'three'">
      <p class="subtitle">
        Enter JV‚Ä≤ and JV‚Ä≥. JVŒ£ is computed as JV‚Ä≤ + JV‚Ä≥ (visualized below as three separate two-voice rows).
      </p>

      <div class="controls">
        <div class="control">
          <label for="jvPrime">JV‚Ä≤</label>
          <input id="jvPrime" type="number" [(ngModel)]="_jvPrimeInput" (ngModelChange)="onThreeVoiceInput()"/>
        </div>

        <div class="control">
          <label for="jvDoublePrime">JV‚Ä≥</label>
          <input id="jvDoublePrime" type="number" [(ngModel)]="_jvDoublePrimeInput"
                 (ngModelChange)="onThreeVoiceInput()"/>
        </div>

        <div class="control">
          <label for="jvSigma">JVŒ£</label>
          <input id="jvSigma" type="number" [value]="_jvSigmaView" readonly/>
        </div>
      </div>

      <h3 style="margin-top:10px">I ‚Üî II (JV‚Ä≤ = {{ _jvPrimeInput }})</h3>
      <app-interval-row
        [_intervalsList]="_indices"
        [_cells]="_cells"
        [_intervals]="_intervals"
        [_jvInput]="_jvPrimeInput">
      </app-interval-row>

      <h3>II ‚Üî III (JV‚Ä≥ = {{ _jvDoublePrimeInput }})</h3>
      <app-interval-row
        [_intervalsList]="_indices"
        [_cells]="_cells"
        [_intervals]="_intervals"
        [_jvInput]="_jvDoublePrimeInput">
      </app-interval-row>

      <h3>I ‚Üî III (JVŒ£ = {{ _jvSigmaView }})</h3>
      <app-interval-row
        [_intervalsList]="_indices"
        [_cells]="_cells"
        [_intervals]="_intervals"
        [_jvInput]="_jvSigmaView">
      </app-interval-row>
    </ng-container>

  </mat-card>
</div>
