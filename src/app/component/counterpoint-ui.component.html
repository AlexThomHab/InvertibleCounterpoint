<div class="cp-wrapper">
  <mat-card class="cp-card" [ngSwitch]="_activeTab">

    <!-- Folder tabs -->
    <!-- Card header (global) -->
    <div class="card-top">
      <h1 class="title">
        {{ _activeTab === 'two'
        ? "Taneev's Vertical Shifting Counterpoint"
        : "Three-Voice Vertical Shifting Counterpoint" }}
      </h1>

      <div class="view-toggle" role="tablist" aria-label="View">
        <button
          class="toggle"
          role="tab"
          [attr.aria-selected]="_activeTab === 'two'"
          [class.active]="_activeTab === 'two'"
          (click)="_activeTab = 'two'">
          2-voice
        </button>
        <button
          class="toggle"
          role="tab"
          [attr.aria-selected]="_activeTab === 'three'"
          [class.active]="_activeTab === 'three'"
          (click)="_activeTab = 'three'">
          3-voice
        </button>
      </div>
    </div>


    <!-- TWO-VOICE VIEW -->
    <ng-container *ngSwitchCase="'two'">
      <div class="card-header">
        <!-- (keep your details/info block exactly as you had it) -->
        <!-- ... -->
      </div>

      <p class="subtitle">
        Enter a JV (inversion index) to see which intervals stay or switch between consonance and dissonance after inversion.
      </p>

      <div class="controls">
        <label for="jv">JV</label>
        <input id="jv" type="number" [(ngModel)]="_jvInput" (ngModelChange)="OnJvInput()" />
      </div>

      <div class="legend">
        <div class="legend-item"><span class="swatch fixedConsonant"></span> Fixed Consonances</div>
        <div class="legend-item"><span class="swatch fixedDissonant"></span> Fixed Dissonances</div>
        <div class="legend-item"><span class="swatch variableConsonant"></span> Variable Consonances</div>
        <div class="legend-item"><span class="swatch variableDissonant"></span> Variable Dissonances</div>
      </div>
      <!-- Notice about suspension logic compromise -->


      <!-- Interval grid -->
      <div class="grid">
        <div
          *ngFor="let i of _indices"
          [ngClass]="getClassForIndex(i)"
          class="cell"
          [matTooltip]="'Interval ' + i"
        >
          <div class="glyph glyph-top"
               [ngClass]="_cells[i]?.topClass"
               [title]="_cells[i]?.topTitle">
            {{ _cells[i]?.topGlyph || '' }}
          </div>

          <div class="interval-number">{{ i }}</div>

          <div class="glyph glyph-bottom"
               [ngClass]="_cells[i]?.bottomClass"
               [title]="_cells[i]?.bottomTitle">
            {{ _cells[i]?.bottomGlyph || '' }}
          </div>
        </div>
      </div>

      <!-- Buckets -->
      <div class="buckets">
        <div><strong>Fixed Consonances:</strong> {{ _invertedIntervals.fixedConsonances.join(', ') }}</div>
        <div><strong>Fixed Dissonances:</strong> {{ _invertedIntervals.fixedDissonances.join(', ') }}</div>
        <div><strong>Variable Consonances:</strong> {{ _invertedIntervals.variableConsonances.join(', ') }}</div>
        <div><strong>Variable Dissonances:</strong> {{ _invertedIntervals.variableDissonances.join(', ') }}</div>
      </div>
    </ng-container>

    <!-- THREE-VOICE VIEW -->
    <ng-container *ngSwitchCase="'three'">
      <div class="card-header">
      </div>

      <p class="subtitle">
        Enter JV′ and JV″. JVΣ is computed as JV′ + JV″ (normalization is handled by the calculator).
      </p>

      <div class="controls">
        <label for="jvPrime">JV′</label>
        <input id="jvPrime" type="number" [(ngModel)]="_jvPrimeInput" (ngModelChange)="onThreeVoiceInput()" />

        <label for="jvDoublePrime">JV″</label>
        <input id="jvDoublePrime" type="number" [(ngModel)]="_jvDoublePrimeInput" (ngModelChange)="onThreeVoiceInput()" />

        <label for="jvSigma">JVΣ</label>
        <input id="jvSigma" type="number" [value]="_jvPrimeInput + _jvDoublePrimeInput" readonly />
      </div>

      <div class="legend">
        <div class="legend-item"><span class="swatch fixedConsonant"></span> Fixed Consonances</div>
        <div class="legend-item"><span class="swatch fixedDissonant"></span> Fixed Dissonances</div>
        <div class="legend-item"><span class="swatch variableConsonant"></span> Variable Consonances</div>
        <div class="legend-item"><span class="swatch variableDissonant"></span> Variable Dissonances</div>
      </div>
      <!-- Notice about suspension logic compromise -->


      <!-- Interval grid (same look as 2-voice, no glyphs needed) -->
      <div class="grid">
        <div
          *ngFor="let i of _indices"
          [ngClass]="getThreeClassForIndex(i)"
          class="cell"
          [matTooltip]="'Interval ' + i"
        >
          <!-- NEW: show strict-most upper/lower suspensions -->
          <div class="glyph glyph-top"
               [ngClass]="_threeCells[i]?.topClass"
               [title]="_threeCells[i]?.topTitle">
            {{ _threeCells[i]?.topGlyph || '' }}
          </div>

          <div class="interval-number">{{ i }}</div>

          <div class="glyph glyph-bottom"
               [ngClass]="_threeCells[i]?.bottomClass"
               [title]="_threeCells[i]?.bottomTitle">
            {{ _threeCells[i]?.bottomGlyph || '' }}
          </div>
        </div>
      </div>
      <!-- Buckets -->
      <div class="buckets">
        <div><strong>Fixed Consonances:</strong> {{ _three.fixedConsonances.join(', ') }}</div>
        <div><strong>Fixed Dissonances:</strong> {{ _three.fixedDissonances.join(', ') }}</div>
        <div><strong>Variable Consonances:</strong> {{ _three.variableConsonances.join(', ') }}</div>
        <div><strong>Variable Dissonances:</strong> {{ _three.variableDissonances.join(', ') }}</div>
      </div>

      <h1>Updates Coming</h1>
      <p>Fix bass voice with 4th issues - Add suspensions - Add pop-up info when clicking on an interval</p>

      <div class="notice">
        <strong>Note:</strong> The 3-voice suspension logic shown here is a pragmatic
        compromise of the approaches discussed (Taneyev/Taneev pairwise “strict-most”
        across JV′, JV″, and JΣ; historically informed allowances). By default we treat
        the 4th above the bass as dissonant and <em>flag</em> context-dependent cases
        like 1→0, 6→7, and 8→7 rather than forbid them outright. We also don’t enforce
        the “resolution note must not already be sounding” rule.
      </div>
    </ng-container>

  </mat-card>
</div>
